menu "UltraLights Configuration"

menu "System"
    config UL_IS_ESP32C3
        bool "Target is ESP32-C3"
        default y if IDF_TARGET_ESP32C3
        default n
        help
            Enable this option when building the firmware for ESP32-C3 based
            hardware. It is automatically selected when the ESP-IDF target is
            set to esp32c3 via `idf.py set-target esp32c3`.
endmenu

menu "Node / Network"
    config UL_NODE_ID
        string "Node ID"
        default "node01"
    config UL_WIFI_SSID
        string "WiFi SSID"
    config UL_WIFI_PSK
        string "WiFi PSK"
    config UL_SNTP_SYNC_INTERVAL_S
        int "SNTP sync interval (seconds)"
        range 60 86400
        default 21600
    config UL_TIMEZONE
        string "Time zone (TZ string)"
        default ""
        help
            POSIX TZ string (e.g., "PST8PDT,M3.2.0/2,M11.1.0/2"). If left empty, UTC is used.
endmenu

menu "MQTT"
    config UL_MQTT_URI
        string "MQTT URI"
        default "mqtt://192.168.1.64:1883"
    config UL_MQTT_USER
        string "MQTT Username"
    config UL_MQTT_PASS
        string "MQTT Password"
endmenu

menu "OTA"
    config UL_OTA_MANIFEST_URL
        string "Manifest URL"
        default "https://lights.evm100.org/firmware/UltraLights/<node-id>/latest.bin"
    config UL_OTA_BEARER_TOKEN
        string "Bearer token"
    config UL_OTA_HMAC_SECRET
        string "Manifest HMAC secret"
    config UL_OTA_ROLLBACK_ENABLE
        bool "Enable rollback"
        default y
    config UL_OTA_SERVER_HOST
        string "Override OTA server host/IP"
        default ""
        help
            If set, this host or IP is used instead of the one in UL_OTA_MANIFEST_URL.
            Useful when your router lacks NAT hairpinning and the firmware server is on the LAN.
    config UL_OTA_COMMON_NAME
        string "OTA server TLS common name"
        default "lights.evm100.org"
        help
            Expected common name in the TLS certificate of the OTA server.
endmenu

menu "Engine"
    config UL_WS2812_FPS
        int "WS2812 FPS"
        range 1 240
        default 60
    config UL_WHITE_SMOOTH_HZ
        int "White smoothing (Hz)"
        range 10 1000
        default 200
    config UL_TRANSITION_MS
        int "Default transition (ms)"
        range 0 5000
        default 250
    config UL_GAMMA_ENABLE
        bool "Enable gamma correction"
        default y
    config UL_DITHER_ENABLE
        bool "Enable dithering (white engine)"
        default y
endmenu

menu "Sensors"
    config UL_PIR_ENABLED
        bool "PIR enabled"
        default y
    config UL_PIR_GPIO
        int "PIR GPIO"
        default 25
    config UL_PIR_EVENT_MIN_INTERVAL_S
        int "PIR minimum publish interval (s)"
        range 1 600
        default 1

    config UL_PIR_POLL_MS
        int "PIR poll rate (ms)"
        range 100 10000
        default 1000

endmenu

menu "WS2812 Strips"
    choice UL_WS_BACKEND
        prompt "WS2812 driver backend"
        default UL_WS_BACKEND_SPI if !UL_IS_ESP32C3
        default UL_WS_BACKEND_RMT
        help
            Select the peripheral used to refresh WS2812 LED strips. The SPI
            backend provides the highest throughput on multi-bus targets such
            as ESP32-S3. The RMT backend is broadly compatible, including with
            ESP32-C3, and should be selected if the target lacks a spare SPI
            host.
        config UL_WS_BACKEND_SPI
            bool "SPI"
        config UL_WS_BACKEND_RMT
            bool "RMT"
    endchoice

    config UL_WS_SPI_USE_DMA
        bool "Use SPI DMA for WS2812 refresh"
        depends on UL_WS_BACKEND_SPI
        default y if !UL_IS_ESP32C3
        default n
        help
            Enable DMA when driving WS2812 strips via the SPI backend. This
            improves refresh throughput on targets that offer dedicated DMA
            channels (e.g. ESP32-S3). Disable on targets where SPI DMA is not
            available.

    menu "Strip 0"
        config UL_WS0_ENABLED
            bool "Enabled"
            default y
        config UL_WS0_GPIO
            int "GPIO"
            default 18
        config UL_WS0_PIXELS
            int "Pixel count"
            default 60
    endmenu
    menu "Strip 1"
        config UL_WS1_ENABLED
            bool "Enabled"
            depends on !(UL_IS_ESP32C3 && UL_WS_BACKEND_SPI)
            default n
        config UL_WS1_GPIO
            int "GPIO"
            default 19
        config UL_WS1_PIXELS
            int "Pixel count"
            default 60
    endmenu
endmenu

menu "White Strips (LEDC)"
    menu "White 0"
        config UL_WHT0_ENABLED
            bool "Enabled"
            default y
        config UL_WHT0_GPIO
            int "GPIO"
            default 5
        config UL_WHT0_LEDC_CH
            int "LEDC Channel"
            range 0 7
            default 0
        config UL_WHT0_PWM_HZ
            int "PWM Hz"
            default 1000
        config UL_WHT0_MIN
            int "Min clamp"
            default 0
        config UL_WHT0_MAX
            int "Max clamp"
            default 255
    endmenu
    menu "White 1"
        config UL_WHT1_ENABLED
            bool "Enabled"
            default n
        config UL_WHT1_GPIO
            int "GPIO"
            default 4
        config UL_WHT1_LEDC_CH
            int "LEDC Channel"
            range 0 7
            default 1
        config UL_WHT1_PWM_HZ
            int "PWM Hz"
            default 1000
        config UL_WHT1_MIN
            int "Min clamp"
            default 0
        config UL_WHT1_MAX
            int "Max clamp"
            default 255
    endmenu
    menu "White 2"
        config UL_WHT2_ENABLED
            bool "Enabled"
            default n
        config UL_WHT2_GPIO
            int "GPIO"
            default 2
        config UL_WHT2_LEDC_CH
            int "LEDC Channel"
            range 0 7
            default 2
        config UL_WHT2_PWM_HZ
            int "PWM Hz"
            default 1000
        config UL_WHT2_MIN
            int "Min clamp"
            default 0
        config UL_WHT2_MAX
            int "Max clamp"
            default 255
    endmenu
    menu "White 3"
        config UL_WHT3_ENABLED
            bool "Enabled"
            default n
        config UL_WHT3_GPIO
            int "GPIO"
            default 15
        config UL_WHT3_LEDC_CH
            int "LEDC Channel"
            range 0 7
            default 3
        config UL_WHT3_PWM_HZ
            int "PWM Hz"
            default 1000
        config UL_WHT3_MIN
            int "Min clamp"
            default 0
        config UL_WHT3_MAX
            int "Max clamp"
            default 255
    endmenu
endmenu

endmenu

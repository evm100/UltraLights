{% extends "base.html" %}
{% block content %}
<div class="mb-6 flex justify-between items-center">
  <h2 class="text-2xl font-semibold">Nodes</h2>
  <button id="addNode" class="w-12 h-12 flex items-center justify-center text-2xl rounded-full bg-indigo-600 hover:bg-indigo-500">+</button>
</div>
<div class="grid md:grid-cols-3 gap-4">
  {% for n in room.nodes %}
  <a href="/node/{{ n.id }}" class="glass rounded-xl p-4 block hover:ring-2 hover:ring-indigo-400">
    <div class="text-sm opacity-70 uppercase tracking-wide">{{ n.kind|upper }}</div>
    <div class="text-xl font-semibold">{{ n.name }}</div>
    <div class="opacity-60 text-xs mt-2">ID: {{ n.id }}</div>
  </a>
  {% endfor %}
</div>
<div class="mt-8">
  <h2 class="text-2xl font-semibold mb-4">Presets</h2>
  <div class="flex flex-wrap gap-2">
    {% for p in presets %}
    <button class="preset glass px-4 py-2 rounded-lg hover:ring-2 hover:ring-indigo-400" data-id="{{ p.id }}">{{ p.name }}</button>
    {% else %}
    <div class="opacity-60">No presets configured.</div>
    {% endfor %}
  </div>
</div>
<script>
document.getElementById('addNode').onclick = async () => {
  const name = prompt('New node name');
  if(!name) return;
  const res = await fetch('/api/house/{{ house.id }}/room/{{ room.id }}/nodes', {
    method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({name})
  });
  if(res.ok) location.reload(); else alert('Failed to add node');
};
document.querySelectorAll('.preset').forEach(btn => {
  btn.onclick = async () => {
    const id = btn.dataset.id;
    const res = await fetch(`/api/house/{{ house.id }}/room/{{ room.id }}/preset/${id}`, {
      method:'POST'
    });
    if(!res.ok) alert('Failed to apply preset');
  };
});
</script>
{% endblock %}
